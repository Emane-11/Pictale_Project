{% extends "pictale_app/base.html" %}

{% block content %}
<h2>Daily Photo</h2>

{% if daily_photo %}
    <div class="photo-card">
        <h3>{{ daily_photo.title }}</h3>
        <img src="{{ daily_photo.image.url }}" alt="{{ daily_photo.title }}" class="photo-img">

        <p>{{ daily_photo.story }}</p>

        <p class="meta">
            Posted on {{ daily_photo.date_featured }}  
            {% if daily_photo.date_taken %}
                (Taken: {{ daily_photo.date_taken }})
            {% endif %}
            <br>
            {{ daily_photo.comments.count }} comment{{ daily_photo.comments.count|pluralize }}
        </p>

        <div class="actions">
            {% if user.is_authenticated %}
                <!-- Like form -->
                <form action="{% url 'like_photo' daily_photo.id %}" method="post" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit">üëç Like ({{ daily_photo.likes.count }})</button>
                </form>

                <!-- Save form -->
                <form action="{% url 'save_photo' daily_photo.id %}" method="post" style="display:inline; margin-left: 10px;">
                    {% csrf_token %}
                    <button type="submit">üíæ Save Photo</button>
                </form>

                <!-- Comment form -->
                <form action="{% url 'add_comment' daily_photo.id %}" method="post" style="margin-top:10px;">
                    {% csrf_token %}
                    <textarea name="comment_text" placeholder="Add a comment..." rows="2"></textarea><br>
                    <button type="submit">Post Comment</button>
                </form>
            {% else %}
                <p><a href="{% url 'login' %}">Login</a> to like, save, or comment.</p>
            {% endif %}
        </div>

        <div class="comments">
            <h4>Comments</h4>
            {% for comment in daily_photo.comments.all %}
                <p><strong>{{ comment.user.username }}</strong>: {{ comment.comment_text }}</p>
            {% empty %}
                <p>No comments yet.</p>
            {% endfor %}
        </div>
    </div>
{% else %}
    <p>No photos yet.</p>
{% endif %}

<style>
    .photo-card {
        background: white;
        padding: 20px;
        margin: 20px auto;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        max-width: 600px;
    }
    .photo-img {
        display: block;
        max-width: 100%;
        max-height: 400px;
        margin: 10px auto;
        border-radius: 6px;
    }
    .meta {
        color: #555;
        font-size: 0.9em;
    }
    .actions {
        margin-top: 15px;
    }
    textarea {
        width: 100%;
        border-radius: 4px;
        padding: 6px;
    }
    button {
        padding: 6px 12px;
        margin-top: 5px;
        cursor: pointer;
    }
    .comments {
        margin-top: 20px;
        border-top: 1px solid #eee;
        padding-top: 10px;
    }
</style>
{% endblock %}
